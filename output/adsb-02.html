<!DOCTYPE html>
<html lang='ru'>
<head>
<meta charset='utf-8'>
<meta content='at8eqeq3' name='author'>
<meta content='Вторая часть бесконечной истории о визуализации данных с ADS-B приёмника.' name='description'>
<meta content='Nanoc 4.12.1' name='generator'>
<meta content='width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0' name='viewport'>
<title>txt.at8eqeq3.me &mdash; О самолётах и данных, часть 2</title>
<link href='/img/userpic.svg' rel='icon' type='image/svg+xml'>
<link href='https://fonts.gstatic.com' rel='preconnect'>
<link href='/stylesheet.css' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500;700&amp;display=swap' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,200;0,300;0,700;1,200;1,300;1,700&amp;display=swap' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css' rel='stylesheet'>
</head>
<body>
<div id='content'>
<div id='header'>
<img alt='at8eqeq3&#39;s userpic' src='/img/userpic.svg'>
<h1>
<a href='/'>txt.at8eqeq3.me</a>
</h1>
<p>//&nbsp;текстятина</p>
</div>
<div id='main'>
<div id='tldr'>Я визуализировал данные со своего радара и мне понравилось.</div>
<div id='epigraph'>В этой части я не улучшаю карту, но рисую красивые картинки.</div>
<h2 id="section">Исходные&nbsp;данные</h2>

<p>Как все давно в курсе, у меня есть <span class="caps">ADS</span>-B приёмник, с которым я время от времени играюсь. В этот раз мне показалось, что было бы интересно собрать в одну кучу все пролетавшие самолёты и посмотреть, как это&nbsp;выглядит.</p>

<p>Есть разные способы изъять нужные данные из dump1090, из них наиболее подходящим для меня стал формат <span class="caps">SBS</span>-3. Сервер включается опцией <code>--net-sbs-port port</code>, где <code>port</code> — это номер tcp-порта, куда надо будет подключаться. Любому, кто туда подключится, будет сливаться поток в виде строк с полями, разделёнными запятыми, что, несомненно, очень удобно для разбора. Формат позволяет передавать много различной информации, dump1090 отдаёт довольно много её видов (хоть и не все), но нам нужны только сообщения с координатами и высотой. Пытливый читатель без труда найдёт описание формата и всё поймёт самостоятельно (там не трудно), не пытливый скопирует строчку в терминал, не забыв подправить адрес и порт (ну, и имя файла, ежели&nbsp;угодно):</p>

<pre><code>nc &lt;ip-address&gt; &lt;port&gt; | grep --line-buffered MSG,3 | cut -d ',' -f 12,15,16 | tee -a points.txt
</code></pre>

<h2 id="section-1">Пережёвываем и&nbsp;визуализируем</h2>

<p>Когда пачка команд, что выше, поработает достаточно долго, у нас будет приличных размеров файл формата <span class="caps">CSV</span>, содержащий, очевидно, высоту в футах (авиаторы — они такие, да) и координаты в виде градусов с десятичными долями. Почти всё хорошо, но есть два момента: иногда в сообщении есть только высота, но нет координат, а ещё высота и координаты имеют слишком разную размерность: первое запросто дойдёт до 40000, второе не бывает больше 180. Поэтому надо, во-первых, пофильтровать битые строки, а во-вторых немного сконвертировать цифры. Если заморочиться, то можно даже расчитать коэффициенты, чтобы пропорции соблюдались. У меня это делает стрёмный скриптик на ruby, который я тут не буду показывать. Наверняка всё то же самое можно было сделать на python и pandas, но мне пока недосуг в это въезжать. В общем, непостижимым образом у нас получился всё тот же <span class="caps">CSV</span>, но подчищенный и причёсанный. Пора делать&nbsp;картинки.</p>

<p>Делать картинки мне помог чудесный инструмент <a href="https://github.com/heremaps/pptk"><span class="caps">PPTK</span></a>, который делает ровно то, что мне надо: получает массив точек и отрисовывает их в <span class="caps">3D</span>, и всё это можно приближать, отдалять и вертеть. Как-то так оно и&nbsp;происходит:</p>

<pre><code>import numpy as np 
import pandas as pd
import pptk

points = pd.read_csv('points.txt', header=None)
points.rename(inplace=True, columns={0: 'alt', 1: 'lat', 2: 'lon'})
P = np.c_[points['lon'], points['lat'], points['alt']]     
v = pptk.viewer(P)
v.attributes(points['alt'])
</code></pre>

<p>В двух словах: подключаем нужные библиотеки, загружаем предварительно причёсанный <span class="caps">CSV</span>, переименовываем колонки, чтобы жилось проще и скармливаем в <span class="caps">PPTK</span>, последней строчкой наводя красоту. А теперь&nbsp;картинки.</p>

<h2 id="section-2">Картинки</h2>

<figure>
  <img src="/img/adsb-02-01.png" alt="Транзитные рейсы" />
  <figcaption>Транзитные рейсы</figcaption>
</figure>

<p>Эта картинка показывает транзитные рейсы: жёлто-красные прямые линии в верхней части — это оно и есть. Большая часть летит с запада на восток и с востока на запад, их-то лучше всего и видно. Кое-где их пересекают линии в других направлениях — это, соответственно, с юга на сервер и наоборот. Между линиями одинаковое расстояние, потому что вертикальное&nbsp;эшелонирование.</p>

<figure>
  <img src="/img/adsb-02-02.png" alt="Аэропорты" />
  <figcaption>Аэропорты</figcaption>
</figure>

<p>Тут я отрезал всё выше <span class="caps">FL100</span>, чтобы показать трафик около аэропортов. Самый большой пучок слева сверху — это, конечно же, Шереметьево. Маленький кудрявый куст чуть ниже — это Хелипорт Москва, вертолётики. Ещё ниже — это Внуково, их тут плохо слышно, поэтому так невзрачно. Правее Внуково — соответственно, Домодедово, а рядом с ним —&nbsp;Жуковский.</p>

<figure>
  <img src="/img/adsb-02-03.png" alt="Шереметьево, вид сбоку" />
  <figcaption>Шереметьево, вид сбоку</figcaption>
</figure>

<p>Это Шереметьево, две ровных горки — это самолёты, садящиеся на полосы <span class="caps">24L</span> и <span class="caps">24C.</span> Отдельная горка — это новая ВПП <span class="caps">24R.</span> У взлетающих бортов чуть больше свободы, чем у садящихся, поэтому горка в противоположном направлении заметно более лохматая. Кстати, с новой полосы за целый день никто не взлетел, только садились. Полосатость — это потому что вертикальное разрешение 25&nbsp;футов.</p>

<figure>
  <img src="/img/adsb-02-04.png" alt="Шереметьево, вид сверху" />
  <figcaption>Шереметьево, вид сверху</figcaption>
</figure>

<p>Всё то же Шереметьево, сверху. Трафик прямо таки повторяет&nbsp;схемы.</p>

<figure>
  <img src="/img/adsb-02-05.png" alt="МАУ до FL100" />
  <figcaption>МАУ до <span class="caps">FL100</span></figcaption>
</figure>

<p>А тут весь (сильное утверждение: на самом деле только то, что слышно моему приёмнику) Московский авиаузел (по-прежнему, ниже <span class="caps">FL100</span>). Сразу видно, кто куда и как&nbsp;летит.</p>

<figure>
  <img src="/img/adsb-02-06.png" alt="Шереметьево, трафик в другую сторону" />
  <figcaption>Шереметьево, трафик в другую сторону</figcaption>
</figure>

<p>Бонус, которого не было на Medium. Это я пособирал данные в другой день. Самолёты взлетали из Шереметьево противоположным курсом, и в этот раз на <span class="caps">06L</span> никто не садился, зато взлетали в полный рост. Видимо, с запада какое-то ограничение&nbsp;есть.</p>

<h2 id="section-3">Заключение</h2>

<p>В целом, задача мне видится решённой. Из возможных&nbsp;улучшений:</p>

<ul>
  <li>улучшение покрытия приёмника. От этого всем будет хорошо. Когда-нибудь я-таки вытащу его на крышу, тогда&nbsp;заживём;</li>
  <li>картинки можно бы генерировать автоматически с некоторой периодичностью — вероятно, <span class="caps">PPTK</span> это позволяет. Можно камеры расставить даже в нужные&nbsp;места.</li>
</ul>

<div id='meta'>
<div id='date'>
<i class='far fa-calendar-alt'></i>&nbsp;2019-10-06
</div>
<div id='tags'>
<i class='fas fa-tags'></i>
<div class='tag'>авиация</div>
<div class='tag'>визуализация данных</div>
<div class='tag'>python</div>
</div>
<div id='links'>
<i class='fas fa-link'></i>
<div class='link'>
<a href='/adsb-01.html'>О самолётах и данных, часть&nbsp;1</a>
</div>
<div class='link'>
<a href='/adsb-03.html'>О самолётах и данных, часть&nbsp;3</a>
</div>
</div>
</div>
</div>
<div id='footer'>
<i class='fas fa-link'></i>
<a href='/'>txt.at8eqeq3.me</a>
<i class='fab fa-github'></i>
<a href='https://github.com/at8eqeq3/txt.at8eqeq3.me'>исходники</a>
<i class='fab fa-creative-commons-by'></i>
<a href='https://creativecommons.org/licenses/by/4.0/'><span class="caps">CC</span>-<span class="caps">BY</span></a>
</div>
</div>
</body>
</html>
