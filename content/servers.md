---
title: О домашних серверах
description: Грустная история о безвременно почившем NAS
date: 2021-08-15
tldr: Однажды у нас издох NAS, и это было неприятно
links:
  - href: https://qnap.ru/ts-251c
    title: QNAP TS-251C
  - href: https://buy.hpe.com/us/en/servers/tower-servers/hpe-proliant-microserver-gen10-plus/p/1012241014
    title: HPE ProLiant MicroServer Gen10 Plus
tags: [it, железо, dxfoto]
---

Я нечасто пишу о технической части наших "Ежедневных фоточек", но иногда --- надо. В этот раз речь пойдёт о такой важной штуке, как локальное хранилище архива.

Да, конечно, можно было бы и это, как и всё остальное, отправить в "облака", но хранить пару терабайт фоток --- несколько дороговато. У нас делается полный бэкап в "холодное" хранилище в GCP, но и это не пять копеек стоит, а оперативно работать с этим невозможно в принципе. "Горячее" хранилище обошлось бы в разы дороже.

В связи с чем, много лет назад, мы обзавелись маленьким домашним сервером --- NAS производства фирмы QNAP. Опыт эксплуатации этого счастья у меня уже был --- похожие девайсы использовались на работе для разных некритичных задач. Очень радовал "коробочный" функционал всего, что только может пригодиться в домашней или мелкой офисной сети --- создание общих папок, одновременно доступных по всем возможным протоколам, в один клик, медиасервер, вспомогательные сетевые сервисы, возможность расширения путём установки официальных и не очень пакетов софта.

В общем, следуя моему давнему убеждению, что в понятии "персональный компьютер" ключевое слово --- "персональный", принимая во внимание, что архив распухает и надо организовать более надёжное хранилище и накопив достаточно денег, мы обзавелись машинкой QNAP TS-251C. Помимо стандартных фич всех подобных устройств меня подкупило то, что машинка работала на x86 процессоре, а не на ARM, что позволяло мне запускать на ней почти любой софт без кросс-компиляции и вот этого всего. Так-то процессор (Celeron J1800) звёзд с неба не хватал, да и встроенной оперативки было маловато (а расширение не предусмотрено). Иногда эта штука жесточайше тупила на всяких тяжёлых задачах. Но в целом делала то, что должна, и особых претензий к ней не было.

До недавних пор.

Одним не самым добрым утром NAS решил, что он --- вертолёт, и раскрутил свой единственный 60мм вентилятор на максимум, что довольно громко. Веб-морда сообщила, что кулер не определяется --- тут да, лучше раскрутить на максимум, чем остановить совсем, спасибо. Сначала, конечно, казалось, что проблема именно в кулере, и стоит его заменить --- и всё будет прекрасно (выяснилось, что купить подходящий --- не самая простая задача, но это ладно). Решил всё же для верности машину перезагрузить. И машина не загрузилась, грустно показывая мне красные лампочки --- почему-то на дисках --- при этом делая вид, что есть сетевая активность, а статусный диод вообще ничего не показывал.

К машинке можно подключить монитор и клавиатуру, что я и сделал. Увидел, что загрузка останавливается почти сразу после бутлоадера. Зашёл в BIOS (это же x86, тут есть настоящий BIOS!), особых проблем не обнаружил, но в мониторинге увидел, что напряжения на линиях питания как-то очень странно скачут, местами даже до неприличных значений. Беглый гуглёж симптомов показал, что я такой счастливый далеко не один, а проблема заключается в деградации LPC BUS процессора, и подвержена ей вся линейка. Можно временно и ненадёжно решить путём напаивания куда-то резистора, а глобально --- только реболл на новый процессор. Где б его только взять --- сто лет в обед всей линейке.

Пришлось раскупоривать кубышку и озадачиваться покупкой нового устройства. На всякие embedded-решения я поглядываю уже с опаской, а для большой машины просто нет места. Зато нашёлся HPE MicroServer Gen10plus, на настоящем Xeon в сокете и с ажно 16 ГБ памяти с возможностью установки ещё одной планки. На сервер (это всё-таки сервер!) был залит CentOS 8, софтовый RAID1 без труда подхватился mdraid, и всё, что остаётся --- это только поднять и отстроить нужные сервисы, чтобы было "как было". Ну, почти --- на нём не будет прежней красивой фичастой веб-мордочки (зато есть суровый Cockpit), но и без неё вполне можно жить, что я --- не юниксовый админ, что ли?

*[GCP]: Google Cloud Platform
*[NAS]: Network Attached Storage
*[BIOS]: Basic Input-Output System